## 动态视距调整技术说明

PaperCard使用自研插件实现了为每个玩家运行时动态调整视距。在保证游戏体验的同时，也减少了服务器卡顿。这是PaperCard的核心技术之一。


### 模拟距离的动态调整

PaperCard使用Folia系列核心，每个区域的游戏逻辑都是分开计算的，自然每个区域的TPS和MSPT也是不一样的。<br />

当玩家所在区域的MSPT低于某个值（当前设置：40）时，会自动升高玩家的模拟距离，直到最大值（当前设置：10）；<br />

当玩家所在区域的MSPT高于某个值（当前设置：50）时，会自动降低玩家的模拟距离，直到最小值（当前设置：4）。<br />

当你长期处于高卡顿区域时，模拟距离会不断降低；回到流畅区域时，模拟距离回升。<br />

已知：当模拟距离小于8时，刷挂塔的刷怪量会降低。<br />



### 发送距离的动态调整

计算所有在线玩家的平均Ping，为avgPing，玩家的Ping为ping。<br />

取两者最大值maxPing=max(avgPing,ping)<br />

当maxPing小于某个值（当前设置80）时，会自动升高该玩家的发送距离；<br />

当maxPing大于某个值（当前设置200）时，会自动降低该玩家的发送距离。<br />

并且调整发送距离的时候，屏幕会闪烁。<br />

当你的网络或服务器网络不佳时，会持续降低发送距离以减少网络卡顿。网络恢复流畅会自动升高。<br />

以当前的设置，当maxPing网络延迟在80~200之间时，发送视距会固定，不会闪屏。


### 视距恢复

退出重进可恢复视距为默认值8，但是仍然会被自动调整。

### 挂机时的视距

玩家长时间不移动自动进入挂机状态，服务器自动将其发送视距调整到最低（2），模拟距离不变。<br />

玩家挂机回来后，发送视距恢复到原值。
